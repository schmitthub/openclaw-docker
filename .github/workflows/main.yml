name: Main

on:
  push:
    branches: [main]

concurrency:
  group: main-${{ github.sha }}
  cancel-in-progress: false

permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  security:
    name: Security
    uses: ./.github/workflows/security.yml
    permissions:
      contents: read
      security-events: write
      actions: read
    secrets: inherit

  lint:
    name: Lint
    uses: ./.github/workflows/lint.yml
    permissions:
      contents: read
      security-events: write
      actions: read

  test:
    name: Test
    uses: ./.github/workflows/test.yml
    permissions:
      contents: read

  licenses:
    name: Licenses
    uses: ./.github/workflows/licenses.yml
    permissions:
      contents: read

  # Future: Integration test jobs will be added here.
  # Use `needs: [security, lint, test]` so integration tests only run
  # after fast checks pass (saves runner minutes on obvious failures).
  # Planned jobs (matching Makefile targets):
  #   test-commands, test-internals, test-acceptance, test-whail, test-agents
